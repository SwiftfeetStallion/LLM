std::throw_with_nested









From cppreference.com





[edit] Diagnostics library



Exception handling

exception

uncaught_exceptionuncaught_exceptions(until C++20*)  (C++17)

exception_ptr(C++11)

make_exception_ptr(C++11)

current_exception(C++11)

rethrow_exception(C++11)

nested_exception(C++11)

throw_with_nested(C++11)

rethrow_if_nested(C++11)

Exception handling failures

terminate

terminate_handler

get_terminate(C++11)

set_terminate

bad_exception

unexpected(until C++17*)

unexpected_handler(until C++17*)

get_unexpected(until C++17*)

set_unexpected(until C++17*)

Error numbers

Error codes

errno

Assertions

assert



Exception categories

logic_error

invalid_argument

domain_error

length_error

out_of_range

runtime_error

range_error

overflow_error

underflow_error

tx_exception(TM TS)

System error

error_category(C++11)

generic_category(C++11)

system_category(C++11)

error_condition(C++11)

errc(C++11)

error_code(C++11)

system_error(C++11)

Stacktrace

stacktrace_entry(C++23)

basic_stacktrace(C++23)

Debugging support

is_debugger_present(C++26)

breakpoint_if_debugging(C++26)

breakpoint(C++26)



[edit] 





 Defined in header <exception>











template< class T >

[[noreturn]] void throw_with_nested( T&& t );

 

(since C++11) (constexpr since C++26)







If std::decay<T>::type is a non-final non-union class type that is neither std::nested_exception nor derived from std::nested_exception, throws an exception of an unspecified type that is publicly derived from both std::nested_exception and from std::decay<T>::type, and constructed from std::forward<T>(t). The default constructor of the nested_exception base class calls std::current_exception, capturing the currently handled exception object, if any, in a std::exception_ptr. 

Otherwise, throws std::forward<T>(t).

Requires that std::decay<T>::type is CopyConstructible.



Contents



1 Parameters

2 Notes

3 Example

4 See also





[edit] Parameters





 t



 -



 the exception object to throw



[edit] Notes





Feature-test macro



Value



Std



Feature





__cpp_lib_constexpr_exceptions

202411L

(C++26)

constexpr for exception types



[edit] Example



[edit]Demonstrates construction and recursion through a nested exception object.Run this code

#include <exception>

#include <fstream>

#include <iostream>

#include <stdexcept>

#include <string>

 

// prints the explanatory string of an exception. If the exception is nested,

// recurses to print the explanatory string of the exception it holds

void print_exception(const std::exception& e, int level =  0)

{

    std::cerr << std::string(level, ' ') << "exception: " << e.what() << '\n';

    try

    {

        std::rethrow_if_nested(e);

    }

    catch (const std::exception& nestedException)

    {

        print_exception(nestedException, level + 1);

    }

    catch (...) {}

}

 

// sample function that catches an exception and wraps it in a nested exception

void open_file(const std::string& s)

{

    try

    {

        std::ifstream file(s);

        file.exceptions(std::ios_base::failbit);

    }

    catch (...)

    {

        std::throw_with_nested(std::runtime_error("Couldn't open " + s));

    }

}

 

// sample function that catches an exception and wraps it in a nested exception

void run()

{

    try

    {

        open_file("nonexistent.file");

    }

    catch (...)

    {

        std::throw_with_nested(std::runtime_error("run() failed"));

    }

}

 

// runs the sample function above and prints the caught exception

int main()

{

    try

    {

        run();

    }

    catch (const std::exception& e)

    {

        print_exception(e);

    }

}

Possible output:



exception: run() failed

 exception: Couldn't open nonexistent.file

  exception: basic_ios::clear



[edit] See also





  nested_exception(C++11)



  a mixin type to capture and store current exceptions  (class) [edit]





  rethrow_if_nested(C++11)



  throws the exception from a std::nested_exception  (function template) [edit]









 





                    